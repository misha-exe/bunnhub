<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bunhub on Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #F8F5F0;
            --secondary: #EEEEEE;
            --accent: #F56E0F;
            --text: #1a1a1a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: var(--bg); color: var(--text); overflow-x: hidden; }

        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: white; position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .logo { font-weight: 800; font-size: 1.2rem; letter-spacing: 1px; }
        .logo span { color: var(--accent); }
        .admin-btn { background: none; border: none; cursor: pointer; font-size: 20px; }

        /* Age Gate */
        #age-gate {
            position: fixed; inset: 0; background: var(--bg); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 30px; text-align: center;
        }
        .gate-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .btn-primary { 
            background: var(--accent); color: white; border: none; 
            padding: 12px 30px; border-radius: 8px; font-weight: bold; margin-top: 20px; cursor: pointer;
        }

        .container { padding: 15px; }
        .video-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .video-card { background: white; border-radius: 12px; overflow: hidden; cursor: pointer; position: relative; }
        .thumb-container { position: relative; width: 100%; aspect-ratio: 16/9; background: #ddd; }
        .thumb-container img { width: 100%; height: 100%; object-fit: cover; }
        .duration { position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; }
        .video-info { padding: 8px; }
        .video-title { font-size: 0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .view { display: none; }
        .view.active { display: block; }

        .player-container { width: 100%; background: black; aspect-ratio: 16/9; position: relative; }
        video { width: 100%; height: 100%; }
        .play-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.3); }
        .play-trigger { width: 60px; height: 60px; background: var(--accent); border-radius: 50%; border: none; color: white; font-size: 24px; cursor: pointer; }

        .admin-form { display: flex; flex-direction: column; gap: 15px; max-width: 400px; margin: 0 auto; }
        input { padding: 12px; border: 2px solid var(--secondary); border-radius: 8px; outline: none; }
    </style>
</head>
<body>

    <div id="age-gate">
        <div class="gate-card">
            <h2>BUN<span>HUB</span></h2>
            <p style="margin: 15px 0; color: #666;">You must be 18+ to view this content.</p>
            <button class="btn-primary" onclick="dismissAgeGate()">I AM 18+ ENTER</button>
        </div>
    </div>

    <header>
        <div class="logo">BUN<span>HUB</span></div>
        <button class="admin-btn" onclick="navigateTo('admin-login')">⚙️</button>
    </header>

    <!-- Views -->
    <main id="home-view" class="view container active">
        <div id="video-grid" class="video-grid"></div>
    </main>

    <div id="player-view" class="view">
        <div class="container">
            <div class="player-container">
                <video id="main-video-player" playsinline></video>
                <div class="play-overlay" id="play-overlay">
                    <button class="play-trigger" onclick="handlePlayClick()">▶</button>
                </div>
            </div>
            <h2 id="player-title" style="margin-top: 15px;"></h2>
        </div>
    </div>

    <div id="admin-login" class="view container">
        <h3>Admin Access</h3>
        <div class="admin-form" style="margin-top:20px;">
            <input type="password" id="admin-pass" placeholder="Password">
            <button class="btn-primary" onclick="loginAdmin()">Login</button>
        </div>
    </div>

    <div id="admin-upload" class="view container">
        <h3>Upload Video</h3>
        <div class="admin-form" style="margin-top:20px;">
            <input type="text" id="vid-title" placeholder="Title">
            <input type="file" id="vid-file" accept="video/*">
            <button class="btn-primary" onclick="handleUpload()">Upload</button>
        </div>
    </div>

    <script>
        const WebApp = window.Telegram.WebApp;
        WebApp.ready();
        WebApp.expand();

        let viewStack = ['home-view'];
        let videos = [
            { id: 1, title: "Epic Soccer Goals", duration: "5:12", thumb: "https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=400", url: "https://www.w3schools.com/html/mov_bbb.mp4" },
            { id: 2, title: "NBA Top Plays", duration: "6:45", thumb: "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=400", url: "https://www.w3schools.com/html/movie.mp4" }
        ];

        const AD_LINK = "https://otieu.com/4/10552085";

        // --- NAVIGATION LOGIC ---
        function navigateTo(viewId) {
            if (viewId === viewStack[viewStack.length - 1]) return;
            viewStack.push(viewId);
            updateUI();
        }

        function goBack() {
            if (viewStack.length > 1) {
                viewStack.pop();
                updateUI();
            }
        }

        function updateUI() {
            const currentView = viewStack[viewStack.length - 1];
            
            // Toggle Views
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(currentView).classList.add('active');

            // Handle Telegram Back Button
            if (viewStack.length > 1) {
                WebApp.BackButton.show();
            } else {
                WebApp.BackButton.hide();
            }

            if(currentView === 'home-view') renderGrid();
        }

        WebApp.BackButton.onClick(() => {
            // Stop video if leaving player
            if(viewStack[viewStack.length-1] === 'player-view') {
                document.getElementById('main-video-player').pause();
            }
            goBack();
        });

        // --- CORE LOGIC ---
        function dismissAgeGate() {
            document.getElementById('age-gate').style.display = 'none';
            renderGrid();
        }

        function renderGrid() {
            const grid = document.getElementById('video-grid');
            grid.innerHTML = '';
            videos.forEach(vid => {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.onclick = () => openPlayer(vid);
                card.innerHTML = `<div class="thumb-container"><img src="${vid.thumb}"><div class="duration">${vid.duration}</div></div><div class="video-info"><div class="video-title">${vid.title}</div></div>`;
                grid.appendChild(card);
            });
        }

        function openPlayer(vid) {
            document.getElementById('player-title').innerText = vid.title;
            const player = document.getElementById('main-video-player');
            player.src = vid.url;
            player.load();
            document.getElementById('play-overlay').style.display = 'flex';
            navigateTo('player-view');
        }

        function handlePlayClick() {
            const player = document.getElementById('main-video-player');
            
            // 1. Trigger the Ad immediately in Telegram Browser
            WebApp.openLink(AD_LINK);

            // 2. Play Video in background immediately
            document.getElementById('play-overlay').style.display = 'none';
            player.play();
        }

        function loginAdmin() {
            if(document.getElementById('admin-pass').value === "admin123") navigateTo('admin-upload');
            else alert("Unauthorized");
        }

        async function handleUpload() {
            const title = document.getElementById('vid-title').value;
            const file = document.getElementById('vid-file').files[0];
            if(!title || !file) return;
            videos.push({ id: Date.now(), title, duration: "New", thumb: "https://via.placeholder.com/400x225", url: URL.createObjectURL(file) });
            goBack();
        }

        window.onload = renderGrid;
    </script>
</body>
</html>
