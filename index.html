<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bunhub - Sports Hub</title>
    <!-- REQUIRED: Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #F8F5F0;
            --secondary: #EEEEEE;
            --accent: #F56E0F;
            --text: #1a1a1a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: var(--bg); color: var(--text); overflow-x: hidden; }

        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: white; position: sticky; top: 0; z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .logo { font-weight: 800; font-size: 1.2rem; letter-spacing: 1px; }
        .logo span { color: var(--accent); }
        .admin-btn { background: none; border: none; cursor: pointer; font-size: 20px; }

        #age-gate {
            position: fixed; inset: 0; background: var(--bg); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 30px; text-align: center;
        }
        .gate-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .btn-primary { 
            background: var(--accent); color: white; border: none; 
            padding: 12px 30px; border-radius: 8px; font-weight: bold; margin-top: 20px; cursor: pointer;
        }

        .container { padding: 15px; }
        .tabs { display: flex; gap: 20px; margin-bottom: 15px; border-bottom: 2px solid var(--secondary); padding-bottom: 10px; }
        .tab { font-weight: 600; color: #888; cursor: pointer; position: relative; }
        .tab.active { color: var(--text); }
        .tab.active::after { content: ''; position: absolute; bottom: -12px; left: 0; width: 100%; height: 3px; background: var(--accent); }

        .video-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .video-card { background: white; border-radius: 12px; overflow: hidden; cursor: pointer; position: relative; }
        .thumb-container { position: relative; width: 100%; aspect-ratio: 16/9; background: #ddd; }
        .thumb-container img { width: 100%; height: 100%; object-fit: cover; }
        .duration { position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; }
        .video-info { padding: 8px; }
        .video-title { font-size: 0.85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .view { display: none; }
        .view.active { display: block; }

        .admin-form { display: flex; flex-direction: column; gap: 15px; max-width: 400px; margin: 0 auto; }
        input { padding: 12px; border: 2px solid var(--secondary); border-radius: 8px; outline: none; }
        input:focus { border-color: var(--accent); }

        .player-container { width: 100%; background: black; aspect-ratio: 16/9; position: relative; }
        video { width: 100%; height: 100%; }
        .play-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.3); }
        .play-trigger { width: 60px; height: 60px; background: var(--accent); border-radius: 50%; border: none; color: white; font-size: 24px; cursor: pointer; }

        /* MODIFIED AD OVERLAY (NO IFRAME) */
        #ad-view {
            position: fixed; inset: 0; background: #1a1a1a; z-index: 2000; 
            display: none; flex-direction: column; align-items: center; justify-content: center;
            color: white; text-align: center; padding: 20px;
        }
        .ad-banner-mock {
            width: 100%; max-width: 300px; height: 250px; 
            background: linear-gradient(45deg, #333, #444);
            border: 2px dashed #666; display: flex; align-items: center;
            justify-content: center; margin-bottom: 20px; border-radius: 15px;
        }
        #unlock-btn { 
            background: var(--accent); color: white; border: none; 
            padding: 15px 40px; border-radius: 30px; font-weight: bold; 
            font-size: 1.1rem; cursor: pointer; transition: 0.3s;
        }
        #unlock-btn:disabled { background: #555; cursor: not-allowed; }

        .back-btn { background: var(--secondary); border: none; padding: 8px 15px; border-radius: 5px; margin-bottom: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <!-- Age Gate -->
    <div id="age-gate">
        <div class="gate-card">
            <h2>BUN<span>HUB</span></h2>
            <p style="margin: 15px 0; color: #666;">You must be 18+ to view this content.</p>
            <button class="btn-primary" onclick="dismissAgeGate()">I AM 18+ ENTER</button>
        </div>
    </div>

    <header>
        <div class="logo">BUN<span>HUB</span></div>
        <button class="admin-btn" onclick="showView('admin-login')">⚙️</button>
    </header>

    <!-- Home View -->
    <main id="home-view" class="view container active">
        <div class="tabs">
            <div class="tab active">Trending</div>
            <div class="tab">Highlights</div>
            <div class="tab">Live</div>
        </div>
        <div id="video-grid" class="video-grid"></div>
    </main>

    <!-- Player View -->
    <div id="player-view" class="view">
        <div class="container">
            <button class="back-btn" onclick="showView('home-view')">← Back</button>
            <div class="player-container">
                <video id="main-video-player" playsinline></video>
                <div class="play-overlay" id="play-overlay">
                    <button class="play-trigger" onclick="handlePlayClick()">▶</button>
                </div>
            </div>
            <h2 id="player-title" style="margin-top: 15px;"></h2>
        </div>
    </div>

    <!-- Admin Login & Upload (Unchanged) -->
    <div id="admin-login" class="view container">
        <button class="back-btn" onclick="showView('home-view')">← Cancel</button>
        <h3>Admin Access</h3>
        <div class="admin-form" style="margin-top:20px;">
            <input type="password" id="admin-pass" placeholder="Enter Admin Password">
            <button class="btn-primary" onclick="loginAdmin()">Login</button>
        </div>
    </div>

    <div id="admin-upload" class="view container">
        <button class="back-btn" onclick="showView('home-view')">← Logout</button>
        <h3>Upload Video</h3>
        <div class="admin-form" style="margin-top:20px;">
            <input type="text" id="vid-title" placeholder="Video Title">
            <input type="file" id="vid-file" accept="video/*">
            <p id="upload-status" style="font-size: 12px; color: var(--accent);"></p>
            <button class="btn-primary" onclick="handleUpload()">Upload to Library</button>
        </div>
    </div>

    <!-- MODIFIED AD OVERLAY (SIMULATED INTERSTITIAL) -->
    <div id="ad-view">
        <div class="ad-banner-mock">
            <p style="color: #888;">Checking Content Safety...</p>
        </div>
        <h3 style="margin-bottom: 10px;">Checking Connection</h3>
        <p style="color: #aaa; font-size: 0.9rem; margin-bottom: 25px;">Please wait while we secure your stream.</p>
        <button id="unlock-btn" disabled onclick="unlockAndPlay()">Wait 5s...</button>
    </div>

    <script>
        // Initialize Telegram WebApp
        const WebApp = window.Telegram.WebApp;
        WebApp.ready();
        WebApp.expand();

        let videos = [
            { id: 1, title: "Epic Soccer Goals", duration: "5:12", thumb: "https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=400", url: "https://www.w3schools.com/html/mov_bbb.mp4" },
            { id: 2, title: "NBA Top Plays", duration: "6:45", thumb: "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=400", url: "https://www.w3schools.com/html/movie.mp4" }
        ];

        let currentVideo = null;
        const AD_DIRECT_LINK = "https://www.effectivegatecpm.com/k0xtu65cf?key=b611e6c7f68535f33273d060d9ce5c1a";

        function dismissAgeGate() {
            document.getElementById('age-gate').style.display = 'none';
            renderGrid();
        }

        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            if(viewId === 'home-view') renderGrid();
        }

        function renderGrid() {
            const grid = document.getElementById('video-grid');
            grid.innerHTML = '';
            videos.forEach(vid => {
                const card = document.createElement('div');
                card.className = 'video-card';
                card.onclick = () => openPlayer(vid);
                card.innerHTML = `<div class="thumb-container"><img src="${vid.thumb}"><div class="duration">${vid.duration}</div></div><div class="video-info"><div class="video-title">${vid.title}</div></div>`;
                grid.appendChild(card);
            });
        }

        function openPlayer(vid) {
            currentVideo = vid;
            document.getElementById('player-title').innerText = vid.title;
            const player = document.getElementById('main-video-player');
            player.src = vid.url;
            player.load();
            document.getElementById('play-overlay').style.display = 'flex';
            showView('player-view');
        }

        // --- UPDATED AD LOGIC (FOLLOWING SCREENSHOT METHOD) ---
        function handlePlayClick() {
            const adView = document.getElementById('ad-view');
            const unlockBtn = document.getElementById('unlock-btn');
            
            adView.style.display = 'flex';
            unlockBtn.disabled = true;
            
            let count = 5;
            const timer = setInterval(() => {
                count--;
                unlockBtn.innerText = `Wait ${count}s...`;
                if(count <= 0) {
                    clearInterval(timer);
                    unlockBtn.innerText = "Unlock & Play Video";
                    unlockBtn.disabled = false;
                }
            }, 1000);
        }

        function unlockAndPlay() {
            // 1. OPEN LINK EXTERNALLY (PER SCREENSHOT STEP 3)
            // This forces the view to count and bypasses iframe blocks
            WebApp.openLink(AD_DIRECT_LINK);

            // 2. RESUME VIDEO IN MINI APP
            document.getElementById('ad-view').style.display = 'none';
            document.getElementById('play-overlay').style.display = 'none';
            document.getElementById('main-video-player').play();
        }

        // Admin functions (Rest unchanged)
        function loginAdmin() {
            if(document.getElementById('admin-pass').value === "admin123") showView('admin-upload');
            else alert("Wrong Pass");
        }

        async function handleUpload() {
            const title = document.getElementById('vid-title').value;
            const file = document.getElementById('vid-file').files[0];
            if(!title || !file) return;
            const url = URL.createObjectURL(file);
            videos.push({ id: Date.now(), title, duration: "New", thumb: "https://via.placeholder.com/400x225", url });
            showView('home-view');
        }
    </script>
</body>
</html>
